<!doctype html>
<html lang="ja">
<head>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rating</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header class="app-header" role="banner">
    <!-- Left: Hamburger + Pull-down -->
    <div class="zone left">
      <button class="icon-btn" id="hamburger" aria-label="メニューを開く" aria-expanded="false" aria-controls="drawer">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
      </button>

      <div class="select-wrap">
        <label for="category" class="sr-only">カテゴリ</label>
        <select id="category" class="category" name="category" aria-label="カテゴリ選択">
          <option value="all">すべて</option>
          <option value="trending">トレンド</option>
          <option value="music">音楽</option>
          <option value="gaming">ゲーム</option>
          <option value="education">学習</option>
          <option value="live">ライブ</option>
        </select>
        <svg class="chev" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
    </div>

    <!-- Center: Site name -->
    <div class="zone center">
      <a href="#" class="site-title" aria-label="ホームへ">Rating</a>
    </div>

    <!-- Right: Search icon + Avatar -->
    <div class="zone right">
      <button class="icon-btn" id="search-toggle" aria-label="検索を開く" aria-expanded="false" aria-controls="search">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"/>
          <path d="M20 20l-3.5-3.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>

      <button class="icon-btn avatar-btn" aria-label="プロフィール">
        <img alt="ユーザーアイコン" src="data:image/svg+xml;utf8,<?xml version='1.0' encoding='UTF-8'?>
        <svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'>
          <defs>
            <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
              <stop offset='0' stop-color='%238f8df1'/>
              <stop offset='1' stop-color='%235a5bd6'/>
            </linearGradient>
          </defs>
          <rect width='100%' height='100%' rx='12' fill='url(%23g)'/>
          <circle cx='32' cy='24' r='12' fill='white' fill-opacity='.9'/>
          <rect x='13' y='38' width='38' height='16' rx='8' fill='white' fill-opacity='.9'/>
        </svg>" />
      </button>
    </div>
  </header>

  <!-- Drawer -->
  <nav id="drawer" class="drawer" aria-hidden="true">
    <div class="drawer__panel">
      <div class="drawer__head">
        <button class="icon-btn" data-close="drawer" aria-label="閉じる">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
        <div class="drawer__title">メニュー</div>
      </div>
      <ul class="drawer__menu">
        <li><a href="#"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d='M3 10l9-7 9 7v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-9z' stroke='currentColor' stroke-width='2' stroke-linejoin='round'/></svg>ホーム</a></li>
        <li><a href="#"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d='M15.5 5h-7A2.5 2.5 0 0 0 6 7.5v9A2.5 2.5 0 0 0 8.5 19h7A2.5 2.5 0 0 0 18 16.5v-9A2.5 2.5 0 0 0 15.5 5z' stroke='currentColor' stroke-width='2'/><path d='M9 8h6M9 12h6M9 16h4' stroke='currentColor' stroke-width='2' stroke-linecap='round'/></svg>ライブラリ</a></li>
        <li><a href="#"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d='M12 5v14M5 12h14' stroke='currentColor' stroke-width='2' stroke-linecap='round'/></svg>アップロード</a></li>
        <li><a href="#"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d='M21 15V8a2 2 0 0 0-1.2-1.8l-6.8-3a2 2 0 0 0-1.9 0l-6.8 3A2 2 0 0 0 3 8v7a2 2 0 0 0 1.2 1.8l6.8 3a2 2 0 0 0 1.9 0l6.8-3A2 2 0 0 0 21 15z' stroke='currentColor' stroke-width='2'/></svg>カテゴリ</a></li>
        <li><a href="#"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx='12' cy='12' r='9' stroke='currentColor' stroke-width='2'/><path d='M12 8v4l3 2' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/></svg>視聴履歴</a></li>
      </ul>
    </div>
    <div class="drawer__scrim" data-close="drawer" aria-hidden="true"></div>
  </nav>

  <!-- Search overlay -->
  <div id="search" class="search" role="dialog" aria-modal="true" aria-hidden="true">
    <form class="search__form" role="search">
      <input type="search" placeholder="動画を検索..." aria-label="検索キーワード" />
      <button class="search__submit" type="submit">検索</button>
    </form>
  </div>

  <script>
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    // Drawer
    const drawer = $('#drawer');
    const hamburger = $('#hamburger');

    function openDrawer(){
      drawer.classList.add('is-open');
      hamburger.setAttribute('aria-expanded','true');
      drawer.setAttribute('aria-hidden','false');
    }
    function closeDrawer(){
      drawer.classList.remove('is-open');
      hamburger.setAttribute('aria-expanded','false');
      drawer.setAttribute('aria-hidden','true');
    }

    hamburger.addEventListener('click', openDrawer);
    drawer.addEventListener('click', (e)=>{
      const target = e.target;
      if (target.matches('[data-close="drawer"], .drawer__scrim')) closeDrawer();
    });

    // Search overlay
    const search = $('#search');
    const searchToggle = $('#search-toggle');
    const searchInput = $('input[type="search"]', search);
    const searchForm  = $('form', search);

    function openSearch(){
      search.classList.add('is-open');
      searchToggle.setAttribute('aria-expanded','true');
      search.setAttribute('aria-hidden','false');
      setTimeout(()=> searchInput && searchInput.focus(), 120);
    }
    function closeSearch(){
      search.classList.remove('is-open');
      searchToggle.setAttribute('aria-expanded','false');
      search.setAttribute('aria-hidden','true');
    }

    searchToggle.addEventListener('click', ()=>{
      search.classList.contains('is-open') ? closeSearch() : openSearch();
    });

    search.addEventListener('click', (e)=>{ if (e.target === search) closeSearch(); });

    // Submit demo
    searchForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      const q = (searchInput.value || '').trim();
      if (!q) return closeSearch();
      console.log('検索:', q);
      closeSearch();
      // 実装例: location.href = `/search?q=${encodeURIComponent(q)}`
    });

    // ESC で閉じる
    window.addEventListener('keydown', (e)=>{
      if (e.key === 'Escape') { closeSearch(); closeDrawer(); }
    });

    // Pull-down (カテゴリ) の例
    const category = $('#category');
    category.addEventListener('change', (e)=>{
      const v = e.target.value;
      console.log('カテゴリ変更:', v);
      // 実装例: location.href = `/category/${encodeURIComponent(v)}`
    });

    // 視覚的に隠す用
    const style = document.createElement('style');
    style.innerHTML = `.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}`;
    document.head.appendChild(style);
  </script>
  </header>

  <main>
</head>

    <div class="rating-range" id="ratingRange"
         data-min="0" data-max="10" data-step="0.1" data-initial-min="2" data-initial-max="8" data-min-gap="0">
      <div class="track" id="track">
        <div class="range-fill" id="fill"></div>
        <button class="thumb" id="thumbMin" role="slider" aria-label="最小評価" aria-valuemin="0" aria-valuemax="10" aria-valuenow="2"></button>
        <button class="thumb" id="thumbMax" role="slider" aria-label="最大評価" aria-valuemin="0" aria-valuemax="10" aria-valuenow="8"></button>
        <output class="bubble" id="bubbleMin">2.0</output>
        <output class="bubble" id="bubbleMax">8.0</output>
      </div>
    </div>

    <p class="hint">ドラッグで範囲を指定。キーボード：<kbd>←/→</kbd>1ステップ、<kbd>PgUp/PgDn</kbd>5ステップ、<kbd>Home/End</kbd>で最小/最大。</p>
  </section>

  <script>
    (()=>{
      const root = document.getElementById('ratingRange');
      const track = document.getElementById('track');
      const fill  = document.getElementById('fill');
      const tMin  = document.getElementById('thumbMin');
      const tMax  = document.getElementById('thumbMax');
      const bMin  = document.getElementById('bubbleMin');
      const bMax  = document.getElementById('bubbleMax');
      const out   = document.getElementById('display');

      // Config
      const MIN = parseFloat(root.dataset.min ?? '0');
      const MAX = parseFloat(root.dataset.max ?? '10');
      const STEP = parseFloat(root.dataset.step ?? '0.1');
      const GAP  = parseFloat(root.dataset.minGap ?? '0');
      let vMin = clamp(parseFloat(root.dataset.initialMin ?? MIN), MIN, MAX);
      let vMax = clamp(parseFloat(root.dataset.initialMax ?? MAX), MIN, MAX);
      if (vMin > vMax) [vMin, vMax] = [vMax, vMin];

      // Helpers
      function clamp(v, a, b){ return Math.min(b, Math.max(a, v)); }
      function snap(v){ const n = Math.round((v - MIN)/STEP); return +(MIN + n*STEP).toFixed(3); }
      function valueToPct(v){ return 100 * (v - MIN) / (MAX - MIN); }
      function pctToValue(p){ return MIN + (MAX - MIN) * p / 100; }

      function layout(){
        // positions in %
        const pMin = valueToPct(vMin);
        const pMax = valueToPct(vMax);
        tMin.style.left = pMin + '%';
        tMax.style.left = pMax + '%';
        bMin.style.left = pMin + '%';
        bMax.style.left = pMax + '%';
        fill.style.left = pMin + '%';
        fill.style.width = (pMax - pMin) + '%';

        const sMin = vMin.toFixed(decimals(STEP));
        const sMax = vMax.toFixed(decimals(STEP));
        bMin.textContent = sMin;
        bMax.textContent = sMax;
        tMin.setAttribute('aria-valuenow', sMin);
        tMax.setAttribute('aria-valuenow', sMax);
        tMin.setAttribute('aria-valuetext', sMin);
        tMax.setAttribute('aria-valuetext', sMax);
        out.textContent = `${sMin} 〜 ${sMax}`;
      }

      function decimals(step){
        const s = step.toString();
        const i = s.indexOf('.');
        return i === -1 ? 0 : (s.length - i - 1);
      }

      // Pointer interactions
      const state = { dragging:null };

      function onPointerDown(e, which){
        e.preventDefault();
        state.dragging = which; 
        e.target.setPointerCapture?.(e.pointerId);
      }

      function onPointerMove(e){
        if(!state.dragging) return;
        const rect = track.getBoundingClientRect();
        const pct = clamp( ( (e.clientX - rect.left) / rect.width ) * 100 , 0, 100);
        let val = snap(pctToValue(pct));
        if(state.dragging === 'min'){
          val = Math.min(val, vMax - GAP);
          vMin = clamp(val, MIN, MAX);
        } else if(state.dragging === 'max'){
          val = Math.max(val, vMin + GAP);
          vMax = clamp(val, MIN, MAX);
        }
        layout();
        emit('input');
      }

      function onPointerUp(){
        if(!state.dragging) return;
        state.dragging = null;
        emit('change');
      }

      function onTrackClick(e){
        // 近い方のサムを動かす
        const rect = track.getBoundingClientRect();
        const pct = clamp( ( (e.clientX - rect.left) / rect.width ) * 100 , 0, 100);
        const val = snap(pctToValue(pct));
        const dMin = Math.abs(val - vMin);
        const dMax = Math.abs(val - vMax);
        if (dMin < dMax){ vMin = clamp(Math.min(val, vMax - GAP), MIN, MAX); }
        else { vMax = clamp(Math.max(val, vMin + GAP), MIN, MAX); }
        layout();
        emit('change');
      }

      // Keyboard accessibility
      function onKey(e, which){
        const unit = STEP;
        const big  = STEP * 5;
        let delta = 0;
        switch(e.key){
          case 'ArrowLeft':  delta = -unit; break;
          case 'ArrowRight': delta =  unit; break;
          case 'PageDown':   delta = -big;  break;
          case 'PageUp':     delta =  big;  break;
          case 'Home':       if(which==='min') vMin = MIN; else vMax = vMin + GAP; layout(); emit('change'); return;
          case 'End':        if(which==='max') vMax = MAX; else vMin = vMax - GAP; layout(); emit('change'); return;
          default: return;
        }
        e.preventDefault();
        if(which==='min'){
          vMin = snap(clamp(vMin + delta, MIN, vMax - GAP));
        } else {
          vMax = snap(clamp(vMax + delta, vMin + GAP, MAX));
        }
        layout();
        emit('input');
      }

      // Events
      tMin.addEventListener('pointerdown', (e)=> onPointerDown(e,'min'));
      tMax.addEventListener('pointerdown', (e)=> onPointerDown(e,'max'));
      window.addEventListener('pointermove', onPointerMove);
      window.addEventListener('pointerup', onPointerUp);
      track.addEventListener('pointerdown', onTrackClick);
      tMin.addEventListener('keydown', (e)=> onKey(e,'min'));
      tMax.addEventListener('keydown', (e)=> onKey(e,'max'));

      // Public change event
      function emit(type){
        const detail = { min:vMin, max:vMax };
        root.dispatchEvent(new CustomEvent('ratingrange' + type, { detail }));
      }

      // Init
      layout();

      // デモ: 変更をコンソールへ
      root.addEventListener('ratingrangeinput', (e)=> console.log('input', e.detail));
      root.addEventListener('ratingrangechange', (e)=> console.log('change', e.detail));

      // Resize relayout (bubbles keep centered via % so基本OKだが一応)
      window.addEventListener('resize', layout);
    })();
  </script> 
  </main>
  <footer>
  </footer>
</body>
</html>
